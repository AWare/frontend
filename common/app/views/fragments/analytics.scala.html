@(page: model.MetaData)( implicit request:RequestHeader)
@import conf.Configuration
@import common.AnalyticsHost
@import views.support.OmnitureAnalyticsData
@import conf.Static
@import conf.Switches.{GlobalDevelopmentQualtrics}

@defining(s"${request.host}${request.path}") { path =>

    @defining(
        s"${AnalyticsHost()}/b/ss/${Configuration.javascript.pageData("guardian.page.omnitureAccount")}/1/H.25.3/?${OmnitureAnalyticsData(page, "No Javascript", path)}"
    ){ omnitureCall =>
            <noscript id="omnitureNoScript">
                <div>
                    <img id="omnitureNoScriptImage" alt=""
                         src="@Html(omnitureCall)" width="1" height="1" class="u-h" />
                </div>
            </noscript>
    }

    @defining(
        s"${AnalyticsHost()}/b/ss/${Configuration.javascript.pageData("guardian.page.omnitureAccount")}/1/H.25.3/?${OmnitureAnalyticsData(page, "Partial Javascript", path)}"
    ){ omnitureCall =>
        <script>
            @*
            //    we do not run our javascript on some browsers, hence analytics will not run.
            //    this does a minimal tracking for those devices
             *@
            if (!guardian.isModernBrowser) {
                var analyticsImage = document.createElement("img");
                analyticsImage.src = "@Html(omnitureCall)";
                analyticsImage.width = "1";
                analyticsImage.height = "1";
                document.body.appendChild(analyticsImage);

                @*
                // this is used to sanity check our analytics calls
                *@
                var img = new Image();
                img.src = "@{Configuration.debug.beaconUrl}/count/pva.gif";

                var s = document.createElement('script'),
                        sc = document.getElementsByTagName('script')[0];

                s.src = '@Static("javascripts/bootstraps/ophan.js")';
                s.aysnc = true;
                sc.parentNode.insertBefore(s, sc);
            }
        </script>
    }
}

@* google remarketing fallback *@
<noscript>
    <div style="display:inline;">
        <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/971225648/?value=0&amp;guid=ON&amp;script=0"/>
    </div>
</noscript>

<img src="@Configuration.debug.beaconUrl/count/pv.gif" alt="" style="display : none ;" rel="nofollow"/>

@if(page.section == "global-development" || page.section == "world" && GlobalDevelopmentQualtrics.isSwitchedOn) {
    <!--BEGIN QUALTRICS SITE INTERCEPT-->
    <script type='text/javascript'>
    (function(){var g=function(e,h,f,g){
    this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
    this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
    this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
    this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=g+ "&t=" + (new Date()).getTime();document.body&&document.body.appendChild(a)}};
    this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
    try{(new g(100,"r","QSI_S_SI_5aOWnkTFKWfkBaR","//zn_ey9aoragdqewxb7-uscannenberg.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_SIID=SI_5aOWnkTFKWfkBaR&Q_LOC="+encodeURIComponent(window.location.href))).start()}catch(i){}})();
    </script><div id='SI_5aOWnkTFKWfkBaR'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END SITE INTERCEPT-->
}


