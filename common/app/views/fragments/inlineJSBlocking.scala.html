@(metaData: model.MetaData)(implicit request: RequestHeader)
@import conf.switches.Switches._
@import common.InlineJs

<!--[if lt IE 9]>
    <script src="@Static("javascripts/components/html5shiv/html5shiv.js")"></script>
<![endif]-->

@fragments.omnitureScript(Some(metaData))

@* NOTE the order of these includes is important  *@
<script id="gu">
    @Html(templates.inlineJS.blocking.js.polyfills().body);
    @InlineJs.withFileNameHint(templates.inlineJS.blocking.js.shouldEnhance(metaData).body, "shouldEnhance.js");
    @Html(templates.inlineJS.blocking.js.guardianConfig(metaData).body);
    @Html(templates.inlineJS.blocking.js.analytics().body);
    @InlineJs.withFileNameHint(templates.inlineJS.blocking.js.applyRenderConditions().body, "applyRenderConditions.js");

    // try and load fonts before we use the stylesheets
    @if(FontSwitch.isSwitchedOn) {
        @InlineJs(templates.inlineJS.blocking.js.loadFonts().body);
    }

    /*
    This borrows *heavily* from https://github.com/filamentgroup/loadCSS.
    The css is loaded by `link`s (in stylesheets.scala.html), but with media of "only x".
    This means the browser requests it, but doesn't block rendering on it, since this media is
    not 'x'. Once it's loaded (appears in `window.document.styleSheets`),  `media` is set to
    `screen` so the browser uses it.
    */
    @if(AsyncCss.isSwitchedOn) {
        @Html(templates.inlineJS.blocking.js.enableStylesheets().body);
    }

    // should this be the usual type of thing we do?
    @* also delete iPhoneConfidenceCheck inside of facia.js *@
    @InlineJs.withFileNameHint(templates.inlineJS.blocking.js.cloudwatchBeacons(metaData).body, "cloudwatchBeacons.js");

    // load the app
    @Html(templates.inlineJS.blocking.js.curlConfig(metaData).body);
    @Html(Static.js.curl);
    @Html(templates.inlineJS.blocking.js.bootEnhanced(metaData).body);
</script>
