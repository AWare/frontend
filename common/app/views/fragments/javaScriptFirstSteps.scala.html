@(item: model.MetaData)(implicit request: RequestHeader)
@import conf.Switches._
@import conf.Static
@import conf.Configuration
@import views.support.OmnitureAnalyticsData

@* Critical scripts that should execute as soon as possible, preventing layout thrashing *@

<!--[if lt IE 9]>
    <script src="@Static("javascripts/components/html5shiv/html5shiv.js")"></script>
<![endif]-->

@fragments.fontDefinitions()

<script id="gu">
    // define polyfills
    @Html(Static.js.polyfills)

    @* NOTE - this is NOT what we want to be doing long term. It is a stopgap measure only *@
    // guess whether the device is too old, regardless of whether it cuts the mustard
    var olderIPadOnFront = @SplitOlderIPadsSwitch.isSwitchedOn && @item.isFront && window.devicePixelRatio === 1;

    @Html(Static.js.isOlderDevice)

    // config
    var guardian = {
        isModernBrowser: (
            'querySelector' in document
                && 'addEventListener' in window
                && 'localStorage' in window
                && 'sessionStorage' in window
                && 'bind' in Function
                && (
                    ('XMLHttpRequest' in window && 'withCredentials' in new XMLHttpRequest())
                        || 'XDomainRequest' in window
                )
                && !isOlderDevice
        ),
        css: {
            loaded: false
        },
        config: @fragments.javaScriptConfig(item)
    };

    (function (doc, win) {
        // feature detection
        var docClass = doc.className;

        @Html(Static.js.featureDetection)

        @if(IPadNothrasherSwitch.isSwitchedOn) {
            if (navigator.platform === 'iPad') {
                docClass += ' ipad-no-thrashers';
            }
        }

        @if(FontKerningSwitch.isSwitchedOn) {
            if (win.location.hash !== '#no-kern') {docClass += ' should-kern'}
        } else {
            if (win.location.hash === '#kern') {docClass += ' should-kern'}
        }

        @* *** MINIMISE DOM THRASHINGâ€¦ *@

        // READs
        @* rems are calculated in the CSS assuming a 16px baseline. if the user has changed theirs, account for it. *@
        var baseFontSize = null;
        if('getComputedStyle' in win) {baseFontSize = win.getComputedStyle(doc).getPropertyValue("font-size")}

        // WRITEs
        if(baseFontSize && parseInt(baseFontSize, 10) !== 16) {doc.style.fontSize = baseFontSize}
        doc.className = docClass.replace(/\bjs-off\b/g, 'js-on');

        @* must always be set before the Omniture file is parsed *@
        win.s_account = "@OmnitureAnalyticsAccount(item)"; //omniture

        @* Not the usual type of thing we do, but I want this separate to our "normal" javascript. *@
        @* also delete iPhoneConfidenceCheck inside of facia.js *@
        @if(IphoneConfidence.isSwitchedOn && Seq("uk", "us", "au").contains(item.id)) {
            @Html(Static.js.cloudwatchBeacons)
        }
    })(document.documentElement, window);
</script>
