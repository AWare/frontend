@(metaData: model.MetaData)(implicit request: RequestHeader)
@import common._

@defining(Edition(request).navigation) { navigation =>
    @defining(Navigation.topLevelItem(navigation, metaData)) { topLevelSelected =>
        <div class="new-navigation">
            <div class="new-navigation__container">
                <div class="local-navigation">
                    @* current top link (if any) *@
                    @topLevelSelected.map {section =>
                        <a class="local-navigation__parent" href="@section.name.href">@section.name.title</a>
                    }

                    @* second level nav *@
                    @topLevelSelected.filter(_.links.nonEmpty).map{ localNav =>
                        <ul class="local-navigation__children">
                            @defining(localNav.links.find(_.currentFor(metaData))){ currentSublink =>

                                @* current second level link (if any) *@
                                @currentSublink.map {s =>
                                    <li class="local-navigation__child local-navigation__child--current">
                                        <a class="local-navigation__action" href="@s.href">@s.title</a>
                                    </li>
                                }

                                @* remaining sub sections *@
                                @localNav.links.filter(_.href != currentSublink.map(_.href).getOrElse("")).map{ link =>
                                    <li><a class="sub-link" href="@link.href">@Html(link.title)</a></li>
                                }
                            }
                        </ul>
                    }
                </div>

                <div class="new-navigation__container">
                    <ul class="global-navigation">
                        @navigation.filter(_.name.href != topLevelSelected.map(_.name.href).getOrElse("")).map { nav =>
                            <li class="global-navigation__section">
                                <a href="@nav.name.href">@Html(nav.name.title)</a>
                                <ul class="global-navigation__children">
                                    @nav.links.map{ link =>
                                        <li class="global-navigation__child">
                                            <a class="global-navigation__action" href="@link.href">@Html(link.title)</a>
                                        </li>
                                    }
                                </ul>
                            </li>
                        }
                    </ul>
                </div>

                <div class="new-navigation__container">
                    <div class="navigation-toggle">
                        <a class="navigation-toggle__action">...</a>
                    </div>
                </div>
            </div>
        </div>
    }
}
