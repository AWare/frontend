@()(implicit request: RequestHeader)

@import common.{ NewNavigation, LinkTo, Edition }
@import conf.switches.Switches.SearchSwitch

@sectionList(topLevelSection: NewNavigation.EditionalisedNavigationSection) = {
    <li class="fly-in-item js-navigation-item"
        data-section-name="@topLevelSection.name">
        <details class="js-close-nav-list"
                 id="primary-list-@topLevelSection.name"
                 open>
            <summary class="fly-in-item__title js-navigation-button"
                     data-link-name="nav2 : secondary : @topLevelSection.name">
                <i class="fly-in-item__toggle"></i>
                @topLevelSection.name
            </summary>

            @defining(Edition(request)) { edition =>
                <ul class="fly-in-group fly-in-group--secondary js-editionalise-secondary-nav"
                    data-edition="@{edition.id.toLowerCase}" >
                    @topLevelSection.getAllEditionalisedNavLinks(edition).map { sectionItem =>
                        <li class="fly-in-item">
                            <a class="fly-in-item__title"
                               href="@LinkTo { @sectionItem.url }"
                               data-link-name="nav2 : secondary : @{ if(sectionItem.longTitle.isEmpty) sectionItem.title else sectionItem.longTitle }">
                                    @if(sectionItem.iconName.nonEmpty) {
                                        @fragments.inlineSvg(sectionItem.iconName, "icon", List("fly-in-item__icon"))
                                    }
                                    @{ if(sectionItem.longTitle.isEmpty) sectionItem.title else sectionItem.longTitle }
                            </a>
                        </li>
                    }
                </ul>
            }
        </details>
    </li>
}

<label for="main-menu-toggle"
       class="fly-in__overlay"
       aria-hidden="true"
       data-link-name="nav2 : overlay"></label>

<div class="fly-in js-main-menu"
     id="main-menu"
     aria-hidden="true">
    <ul class="fly-in-group fly-in-group--primary">
        @NewNavigation.topLevelSections.map { section =>
            @sectionList(section)
        }
    </ul>

    @if(SearchSwitch.isSwitchedOn) {
        <form class="fly-in-search"
              action="https://www.google.co.uk/search">
            <input type="text"
                   name="q"
                   class="fly-in-search__search-box"
                   placeholder="search for..."
                   data-link-name="nav2 : search">

            <input type="hidden"
                   name="as_sitesearch"
                   value="www.theguardian.com">

            @* label surrounding the input and icon so that if you
            click the search icon it will trigger the submit *@
            <label for="submit-google-search"
                   class="fly-in-search__submit">
                <input class="u-h"
                       type="submit"
                       id="submit-google-search"
                       data-link-name="nav2 : search : submit">
                @fragments.inlineSvg("search-36", "icon", List("main-menu__icon", "main-menu__icon--search"))
            </label>

            <label for="q"
                   class="u-h">
                What term do you want to search?
            </label>
        </form>
    }

    <ul class="fly-in-group fly-in-group--highlight">
        @defining(Edition(request)) { edition =>
            @NewNavigation.getMembershipLinks(edition).mostPopular.map { item =>
                <li class="fly-in-item js-editionalise-secondary-nav"
                    data-edition=@{edition.id.toLowerCase}>

                    <a class="fly-in-item__title"
                       href="@item.url"
                       data-link-name="nav2 : @item.title">
                        @item.title
                    </a>
                </li>
            }
        }

        @fragments.nav.userAccountLinks()
        @fragments.nav.editionPicker()
    </ul>

    @defining(Edition(request)) { edition =>
        <ul class="fly-in-group js-editionalise-secondary-nav"
            data-edition=@{edition.id.toLowerCase}>

            @NewNavigation.NavFooterLinks.getAllEditionalisedNavLinks(edition).map { item =>
                <li class="fly-in-item">
                    <a class="fly-in-item__title"
                       href="@LinkTo { @item.url }"
                       data-link-name="nav2 : @item.title">
                        @item.title
                    </a>
                </li>
            }
        </ul>
    }

    <ul class="fly-in-group">
        <li class="fly-in-item">
            <a class="fly-in-item__title"
               href="https://www.facebook.com/theguardian"
               data-link-name="nav2 : facebook">
                @fragments.inlineSvg("share-facebook", "icon", List("fly-in-item__icon"))
                Facebook
            </a>
        </li>

        <li class="fly-in-item">
            <a class="fly-in-item__title"
               href="https://twitter.com/guardian"
               data-link-name="nav2 : twitter">
                @fragments.inlineSvg("share-twitter", "icon", List("fly-in-item__icon"))
                Twitter
            </a>
        </li>
    </ul>
</div>
