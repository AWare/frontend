@import conf.Static
@import views.support.RenderClasses
@import conf.switches.Switches.ProfileShowContributorTab
@import model.{ApplicationContext, EmailNewsletters, IdentityPage}
@import services.EmailPrefsData
@import form.IdFormHelpers.nonInputFields
@import views.support.`package`.Seq2zipWithRowInfo


@(
    page: model.Page,
    user: com.gu.identity.model.User,
    forms: controllers.ProfileForms,
    idRequest: services.IdentityRequest,
    idUrlBuilder: services.IdentityUrlBuilder,
    emailPrefsForm: Form[EmailPrefsData],
    emailSubscriptions: List[String],
    availableLists: EmailNewsletters
)(implicit request: RequestHeader, messages: play.api.i18n.Messages, context: model.ApplicationContext)

@mainLegacy(page, projectName = Option("identity")) { } {

    <div class="identity-wrapper-for-bg">
        <div class="gs-container">
            <div class="monocol-wrapper">

                <div class="u-cf identity-section identity-wrapper">

                    <form novalidate action="@idUrlBuilder.buildUrl("/privacy/edit", idRequest)" role="main" method="post">
                        @views.html.helper.CSRF.formField
                        @fragments.form.hidden(emailPrefsForm("htmlPreference"))

                        <div class="js-errorHolder manage-account__errors"></div>

                        <div class="manage-account-wizard" >
                            <div class="manage-account-wizard__step">
                            <center>
                                <img width="100%" src="https://i.imgur.com/TqI7Ub8.png" />
                            </center>
                        </div>
                            <div class="manage-account-wizard__step">

                                <h2 class="manage-account-header">We need you to consent again to receiving communications from The Guardian</h2>
                                <p class="manage-account-headerNote">These are all the permissions you already consented to, please review them and check them again if you still want to receive them</p>
                                <div class="fieldset fieldset--manage-account-noborder fieldset--manage-account-block">
                                    <div class="manage-account__switches">
                                        <ul>
                                        @helper.repeat(forms.privacyForm("consents"), min=1) { consentField =>
                                            <li>
                                                @fragments.consentCheckbox(consentField)(messages)
                                            </li>
                                        }
                                        </ul>
                                    </div>
                                </div>

                                <p class="manage-account-headerNote">While you are here, you can also sign up for these ones:</p>
                                <div class="fieldset fieldset--manage-account-noborder fieldset--manage-account-block">
                                    <div class="manage-account__switches">
                                        <ul>
                                        @helper.repeat(forms.privacyForm("consents"), min=1) { consentField =>
                                            <li>
                                                @fragments.consentCheckbox(consentField)(messages)
                                            </li>
                                        }
                                        </ul>
                                    </div>
                                </div>

                            </div>
                            <div class="manage-account-wizard__step">
                                <h2 class="manage-account-header">Email Preferences</h2>
                                <p class="manage-account-headerNote">You were receiving these newsletters, check them again to confirm you want to keep receiving them.</p>
                                <div class="manage-account__switches">
                                    <ul>
                                    @availableLists.subscriptions.filter(_.theme == "news").zipWithRowInfo.map { case (newsletter, row) =>
                                        <li>
                                            @fragments.form.switchNewsletter(
                                                newsletter = newsletter
                                            )(nonInputFields, messages, request, emailPrefsForm, emailSubscriptions)
                                        </li>
                                    }
                                    </ul>
                                </div>
                            </div>
                            <div class="manage-account-wizard__step">
                                <img src="https://i.imgur.com/XoJmEro.png" width="100%" />
                            </div>
                            <div class="manage-account-wizard__controls">
                                <div class="manage-account-wizard__controls-pager"></div>
                                <a class="manage-account__button js-manage-account-wizard__next">Next</a>
                            </div>
                        </div>

                    </form>

                </div>
            </div>
        </div>
    </div>
}
