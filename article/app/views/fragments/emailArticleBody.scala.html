@(page: PageWithStoryPackage)(implicit request: RequestHeader)

@import views.support.EmailArticleImage
@import views.support.Zurb._
@import model.liveblog._

@defining(page.article) { article =>
    <table class="container">
        <tr>
            <td>
                @paddedRow {
                    <h1>@article.trail.headline</h1>
                }

                @fragments.emailMainMedia(article)

                @paddedRow(Seq("author-outer")) {
                    @article.trail.byline.map { byline =>
                        <div class="author">
                            <h3 class="byline">@byline</h3>

                            @if(article.content.tags.contributors.length == 1) {
                                @fragments.meta.contactAuthor(article.tags)
                            }
                        </div>
                    }
                }

                @page.article.fields.blocks.map { block =>
                    @block.elements.map { element =>
                        @element match {
                            case TextBlockElement(Some(html)) => { @paddedRow(Html(html)) }
                            case EmbedBlockElement(Some(html), _, _) => { @fullRow(Html(html)) }
                            case ImageBlockElement(media, data, showCredit) => {
                                @EmailArticleImage.bestFor(media).map { url =>

                                    @fullRow {
                                        <img width="580" src="@url" @data.get("alt").map { alt => alt="@alt" }>
                                    }

                                    @paddedRow(Seq("caption")) {
                                        @data.get("caption").map { caption =>
                                            <small>@Html(caption)</small>
                                        }

                                        @if(showCredit) {
                                            <small>@data.get("credit").map(Html(_))</small>
                                        }
                                    }
                                }
                            }
                            case _ => {}
                        }
                    }
                }
            </td>
        </tr>
    </table>
}
