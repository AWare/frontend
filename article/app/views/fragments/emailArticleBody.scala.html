@(page: PageWithStoryPackage)(implicit request: RequestHeader)

@import views.support.EmailArticleImage
@import views.support.EmailHelpers._
@import model.liveblog._
@import model.EmailAddons.EmailArticle

@defining(page.article) { article =>
    @fullRow {
        <img width="580" src="@article.banner">
    }

    @paddedRow {
        <h1>@article.trail.headline</h1>
    }

    @article.fields.standfirst.map { standfirst =>
        @paddedRow(Html(standfirst))
    }
    
    @fragments.emailMainMedia(article)

    @paddedRow(Seq("author")) {
        @article.trail.byline.map { byline =>
            <h3 class="byline">@byline</h3>

        @article.tags.contributors.headOption.map { profile =>
            @profile.properties.twitterHandle.map { twitter =>
                <div class="meta__twitter">
                    <a href="http://twitter.com/@twitter" data-link-name="twitter-handle" data-component="meta-twitter-handle" class="button button--small button--secondary tone-colour">
                        @icon("twitter-bird")
                        <div class="contact">@@@twitter</div>
                    </a>
                </div>
            }
            @profile.properties.emailAddress.map { email =>
                <div class="meta__email">
                    <a href="mailto:@email" data-link-name="email-address" data-component="meta-email-address" class="button button--small button--secondary tone-colour">
                        @icon("mail")
                        <div class="contact">email</div>
                    </a>
                </div>
            }
        }

            <hr />
        }
    }

    @page.article.fields.blocks.map { block =>
        @block.title.map { title =>
            @paddedRow {
                <h2 class="block__title">@title</h2>
            }
        }

        @block.elements.map { element =>
            @element match {
                case TextBlockElement(Some(html)) => {
                    @paddedRow(Html(html))
                }

                case EmbedBlockElement(Some(html), _, _) => {
                    @*fullRow(Html(html))*@
                }

                case ImageBlockElement(media, data, showCredit) => {
                    @EmailArticleImage.bestFor(media).map { url =>

                        @fullRow {
                            <img width="580" src="@url" @data.get("alt").map { alt => alt="@alt" }>
                        }

                        @paddedRow {
                            @data.get("caption").map { caption =>
                                <div class="caption">
                                    @icon("camera")

                                    @Html(caption)

                                    @if(showCredit) {
                                        @data.get("credit").map(Html(_))
                                    }

                                    <hr />
                                </div>
                            }
                        }
                    }
                }
                case _ => {}
            }
        }
    }
}
