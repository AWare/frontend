@(page: PageWithStoryPackage)(implicit request: RequestHeader)

@import views.support.EmailArticleImage
@import views.support.Zurb._
@import model.liveblog._

@defining(page.article) { article =>
    <table class="container">
        <tr>
            <td>
                @paddedRow {
                    <h1>@article.trail.headline</h1>
                }

                @fragments.emailMainMedia(article)

                @paddedRow(Seq("author")) {
                    @article.trail.byline.map { byline =>
                        <h3 class="byline">@byline</h3>

                        @if(article.content.tags.contributors.length == 1) {
                            @fragments.meta.contactAuthor(article.tags)
                        }

                        <hr />
                    }
                }

                @page.article.fields.blocks.map { block =>
                    @block.elements.map { element =>
                        @element match {
                            case TextBlockElement(Some(html)) => { @paddedRow(Html(html)) }
                            case EmbedBlockElement(Some(html), _, _) => { @fullRow(Html(html)) }
                            case ImageBlockElement(media, data, showCredit) => {
                                @EmailArticleImage.bestFor(media).map { url =>

                                    @fullRow {
                                        <img width="580" src="@url" @data.get("alt").map { alt => alt="@alt" }>
                                    }

                                    @paddedRow {
                                        @data.get("caption").map { caption =>
                                            <div class="caption">
                                                @fragments.inlineSvg("camera", "icon", Seq("i-left"))

                                                @Html(caption)

                                                @if(showCredit) {
                                                    @data.get("credit").map(Html(_))
                                                }

                                                <hr />
                                            </div>
                                        }
                                    }
                                }
                            }
                            case _ => {}
                        }
                    }
                }
            </td>
        </tr>
    </table>
}
