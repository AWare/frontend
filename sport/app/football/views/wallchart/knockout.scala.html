@(competition: model.Competition, knockoutStage: _root_.football.model.Knockout)(implicit request: RequestHeader)

<div class="football-knockouts">
    @knockoutStage.rounds.zipWithRowInfo.map{ case (round, row) =>
        @round.name.map { name =>
            @fragments.dropdown(name, isActive = row.isFirst){
                <ul class="u-unstyled u-cf">
                    @defining(knockoutStage.matchesList(competition, round)) { matches =>
                        <li>
                            @matches.matchesGroupedByDateAndCompetition.zipWithRowInfo.map { case ((date, competitionMatches), info) =>
                                @competitionMatches.map { case (competition, matches) =>
                                    @football.views.html.matchList.matchesList(matches, competition, date,
                                        linkToCompetition = false,
                                        heading = if(info.isFirst) Option("Fixtures and results") else None
                                    )
                                }
                            }
                        </li>
                    }
                </ul>
            }
        }
    }
</div>

<div class="football-knockout-chart football-knockout-chart--@knockoutStage.rounds.length-rounds u-cf">
    <div class="football-rounds football-rounds--first-half">
        @knockoutStage.rounds.map{ round =>
            @defining(knockoutStage.roundMatches(round)) { matches =>
                @if(matches.length != 1){
                    <div class="football-round football-round--@matches.length-matches">
                        <div class="football-round__name">@round.name.getOrElse("")</div>

                        @defining(matches.length/2) { half =>
                            <div class="football-round__matches">
                                @matches.take(half).map{ m =>
                                    @football.views.html.wallchart.knockoutMatch(m, round)
                                }
                            </div>
                        }
                    </div>
                }
            }
        }
    </div>

    <div class="football-rounds football-rounds--second-half">
        @knockoutStage.rounds.map{ round =>
            @defining(knockoutStage.roundMatches(round)) { matches =>
                @if(matches.length != 1){
                    <div class="football-round football-round--@matches.length-matches">
                        <div class="football-round__name">@round.name.getOrElse("")</div>
                            @defining(matches.length/2) { half =>
                                <div class="football-round__matches">
                                    @matches.drop(half).map{ m =>
                                        @football.views.html.wallchart.knockoutMatch(m, round)
                                    }
                                </div>
                            }
                    </div>
                }
            }
        }
    </div>

    <div class="football-rounds football-rounds--finals">
        @knockoutStage.rounds.map{ round =>
            @defining(knockoutStage.roundMatches(round)) { matches =>
                @if(matches.length == 1){
                    <div class="football-round football-round--@matches.length-matches football-round--final @round.name.filter(n => n == "3rd/4th Play-Offs").map{ name => football-round--playoff}">
                        <div class="football-round__name">@round.name.getOrElse("")</div>
                        <div class="football-round__matches">
                            @matches.map{ m =>
                                @football.views.html.wallchart.knockoutMatch(m, round)
                            }
                        </div>
                    </div>
                }
            }
        }
    </div>
</div>
