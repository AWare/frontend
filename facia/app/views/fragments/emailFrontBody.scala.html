@import layout.{FaciaCard, FaciaCardHeader}
@import model.pressed.PressedContent
@import layout.EditionalisedLink
@import model.EmailAddons.EmailContentType

@import layout.ItemClasses
@import layout.ContentCard
@(page: model.PressedPage)(implicit request: RequestHeader)

@import views.support.EmailHelpers._
@import views.support.TrailCssClasses.toneClassFromStyle
@import model.pressed.{Feature, ExternalLink}
@import implicits.Requests.RichRequestHeader
@import implicits.ItemKickerImplicits._


@headline(card: ContentCard) = {
    <h3 class="headline">
        @card.header.kicker.map { kicker =>
            <span class="fc-item__kicker">@Html(kicker.kickerHtml)</span>
            <span class="kicker-separator">/</span>
        }

        @defining(if(request.isEmailConnectedStyle) "-connected" else "") { suffix =>
            @if(card.header.isGallery) {
                @icon("gallery" + suffix)
            }
            @if(card.header.isAudio) {
                @icon("podcast" + suffix)
            }
            @if(card.header.isVideo) {
                @icon("video" + suffix)
            }
        }

        @if(card.header.quoted) {
            @card.cardStyle match {
                case Feature => {
                    @icon("quote-feature")
                }
                case _ => {
                    @icon("quote")
                }
            }
        }
        @card.header.headline
    </h3>
    @if(card.header.quoted) {
        @card.bylineText.map { byline => <h4 class="byline">@byline</h4> }
    }
}

@faciaCardLarge(card: ContentCard) = {
    @paddedRow(Seq(toneClassFromStyle(card.cardStyle))) {
        <a @Html(card.header.url.hrefWithRel) class="facia-link">
            <div class="facia-card facia-card--large">
                @imgFromCard(card)
                @fullRow(Seq("facia-card__text")) {
                    @headline(card)
                    @card.trailText.map { trailText =>
                        <h4 class="trail-text">@trailText</h4>
                    }
                }
            </div>
        </a>
    }
}

@faciaCardSmall(card: ContentCard) = {
    @paddedRow(Seq(toneClassFromStyle(card.cardStyle))) {
        <a @Html(card.header.url.hrefWithRel) class="facia-link">
            @fullRow(Seq("facia-card", "facia-card__text")) {
                @headline(card)
            }
        </a>
    }
}

@firstCard(card: ContentCard) = {
    @card.cardStyle match {
        case ExternalLink => { @faciaCardSmall(card) }
        case _ => { @faciaCardLarge(card) }
    }
}

@otherCard(card: ContentCard) = {
    @faciaCardSmall(card)
}

@fullRow {
    @imgForFront(page.banner, page.email.map(_.name))
}

@page.frontProperties.onPageDescription.map { description =>
    @paddedRow {
        <p class="introduction">@description</p>
    }
}

@page.collections.zipWithIndex.map { case (collection, collectionIndex) =>
    @paddedRow {
        <h2 class="container-title @if(collectionIndex > 0) { container-title--not-first }">
            @collection.displayName
        </h2>
    }

    @collection.curatedPlusBackfillDeduplicated.zipWithIndex.map { case (pressedContent, cardIndex) =>
        @defining(FaciaCard.fromTrail(pressedContent, collection.config, ItemClasses.showMore, showSeriesAndBlogKickers = false)) { card =>
            @if(cardIndex == 0) {
                @firstCard(card)
            } else {
                @otherCard(card)
            }
        }
    }
}
