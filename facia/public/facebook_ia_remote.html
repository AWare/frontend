<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex">
    <script>
    </script>
</head>
<body style="margin:0">
<div id="c" style="position:absolute;top:0;left:0;bottom:0;right:0;">

    <script>
        (function () {

            var script = document.createElement("script");
            script.id = "ad-slot-id";

            var args = window.location.search.substr(1).split('&');

            for (var i = 0; i < args.length; ++i) {
                var arg = args[i].split("=");
                var argName = arg[0];
                var argValue = decodeURIComponent(arg[1]);

                var currValue = script.getAttribute(argName);
                if (currValue) {
                    script.setAttribute(argName, currValue + "," + argValue);
                } else {
                    script.setAttribute(argName, argValue);
                }
            }

            document.getElementsByTagName("div")[0].appendChild(script);

            var networkId = "59666047";

            var scripts = document.querySelectorAll("script[id$='" + script.id + "']");

            var slot = scripts[scripts.length - 1];

            var slotName = "ad-slot-" + scripts.length;

            var buildTargetSize = function (size) {
                var formatted = size.replace(/\s*,\s*/g, "],[").replace(/\s*x\s*/g, ",");
                return "[[" + formatted + "]]";
            };

            var buildCustomTargeting = function () {
                var attr, i, key, len, match, value;
                var targeting = "";
                var ref = slot.attributes;
                for (i = 0, len = ref.length; i < len; i++) {
                    attr = ref[i];
                    match = attr.name.match(/^data-ad-target-(.+)$/);
                    if (match != null) {
                        key = match[1];
                        value = attr.value.replace(/\s*,\s*/g, "','");
                        targeting += ".setTargeting('" + key + "',['" + value + "'])";
                    }
                }
                return targeting;
            };

            var pageLevelCodePart1 = "var googletag = googletag || {}; googletag.cmd = googletag.cmd || []; (function() { var gads = document.createElement(\"script\"); gads.async = true; gads.type = \"text/javascript\"; var useSSL = \"https:\" == document.location.protocol; gads.src = (useSSL ? \"https:\" : \"http:\") + \"//www.googletagservices.com/tag/js/gpt.js\"; var node = document.getElementsByTagName(\"script\")[0]; node.parentNode.insertBefore(gads, node); })();";

            var pageLevelCodePart2 = "googletag.cmd.push(function() { googletag.pubads().enableAsyncRendering(); googletag.pubads().collapseEmptyDivs(); googletag.enableServices(); });";

            var buildSlotDeclaration = function (size) {
                var adUnitName = slot.getAttribute("data-ad-unit");
                return "googletag.cmd.push(function() { googletag.defineSlot('/" + networkId + "/" + adUnitName + "', " + (buildTargetSize(size)) + ", '" + slotName + "')" + (buildCustomTargeting()) + ".addService(googletag.pubads()); });";
            };

            var buildSlotCode = function () {
                return "googletag.cmd.push(function() { googletag.display('" + slotName + "'); });";
            };

            var insertScript = function (content) {
                var script = document.createElement("script");
                slot.parentElement.appendChild(script);
                script.type = "text/javascript";
                return script.text = content;
            };

            var insertAdConfig = function () {
                var isFirstAd = scripts.length === 1;
                if (isFirstAd) {
                    insertScript(pageLevelCodePart1);
                    insertScript(pageLevelCodePart2);
                }
                var size = slot.getAttribute("data-ad-size");
                return insertScript(buildSlotDeclaration(size));
            };

            var insertAd = function () {
                var slotDiv = document.createElement("div");
                slotDiv.setAttribute("id", slotName);
                slot.parentElement.appendChild(slotDiv);
                return insertScript(buildSlotCode());
            };

            // Krux

            var guardian = {} ;

            function toTitleCase(str) {
                return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
            }

            function exposeMetaDataForKrux() {
                guardian = { 'config' : {
                    'page' : {
                        'pageId' : slot.getAttribute("url"),
                        'edition' : toTitleCase(slot.getAttribute("edition")),
                        'seriesId' : slot.getAttribute("se"),
                        'contentType' : toTitleCase(slot.getAttribute("ct")),
                        'keywordIds' : slot.getAttribute("keywordIds"),
                        'keywords' : slot.getAttribute("k").split(',').map(function (x) { return toTitleCase(x)}),
                        'authorIds' : slot.getAttribute("authorIds"),
                        'blogIds' : slot.getAttribute("bl"),
                        'referrer' : 'facebook-ia',
                        'section' : slot.getAttribute("section")
                    }
                }
                };
            }

            function loadKrux() {
                var krux = document.createElement('script');
                krux.setAttribute("class", "kxct");
                krux.setAttribute("data-id", "KS_cfybw");
                krux.setAttribute("data-timing", "async");
                krux.setAttribute("data-version", "1.9");
                krux.setAttribute("type", "text/javascript");

                krux.innerHTML = "window.Krux||((Krux=function(){Krux.q.push(arguments)}).q=[]); " +
                    "(function(){ " +
                    "var k=document.createElement('script');k.type='text/javascript';k.async=true; " +
                    "var m,src=(m=location.href.match(/\bkxsrc=([^&]+)/))&&decodeURIComponent(m[1]); " +
                    "k.src = /^https?:\\/\\/([a-z0-9_\\-\\.]+\\.)?krxd\\.net(:\\d{1,5})?\\//i.test(src) ? src : src === 'disable' ? '' : " +
                    "(location.protocol==='https:'?'https:':'http:')+'//cdn.krxd.net/controltag?confid=KS_cfybw' ; " +
                    "var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s); }());";

                document.body.appendChild(krux);
            }

            function attachKruxSegments() {
                if (localStorage.getItem('kxsegs') !== null) {
                    var kxSegList = localStorage.getItem('kxsegs').split(',');
                    console.log(kxSegList);
                    if (kxSegList.length > 0) {
                        guardian.krux = kxSegList;
                    }
                }
                else {
                    console.log('No krux segments.')
                }
            }

            function init(){
                exposeMetaDataForKrux();
                loadKrux();
                attachKruxSegments();

                insertAdConfig();
                insertAd();
            }

            init();

        }).call(this);
    </script>

</div>
<script>if (window.docEndCallback) window.docEndCallback()</script>
</body>
</html>
