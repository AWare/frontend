<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex">
    <script>
    </script>
</head>
<body style="margin:0">
<div id="c" style="position:absolute;top:0;left:0;bottom:0;right:0;">

    <script>
        var settings = parseParameters();
        var config = {};

        function parseParameters() {
            var params = {};
            var args = window.location.hash.substr(1).split('&');
            var i, argsLength = args.length;

            for (i = 0; i < argsLength; ++i) {
                var arg = args[i].split("=");
                var argName = decodeURIComponent(arg[0]);
                var argValue = decodeURIComponent(arg[1]);

                if (params[argName] !== undefined) {
                    params[argName] += ',' + argValue;
                } else {
                    params[argName] = argValue;
                }
            }

            return params;
        }

        function toTitleCase(str) {
            return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
        }

        function exposeMetaDataForKrux() {
            config = {
                'pageId' : settings.url,
                'edition' : toTitleCase(settings.edition),
                'seriesId' : settings.se,
                'contentType' : toTitleCase(settings.ct),
                'keywordIds' : settings.keywordIds,
                'keywords' : settings.k.split(',').map(toTitleCase),
                'authorIds' : settings.authorIds,
                'blogIds' : settings.bl,
                'referrer' : 'facebook-ia',
                'section' : settings.section
            };
        }

        function loadKrux() {
            var krux = document.createElement('script');
            krux.setAttribute("class", "kxct");
            krux.setAttribute("data-id", "J_RxuxWJ");
            krux.setAttribute("data-timing", "async");
            krux.setAttribute("data-version", "1.9");
            krux.setAttribute("type", "text/javascript");

            krux.innerHTML = "window.Krux||((Krux=function(){Krux.q.push(arguments)}).q=[]); " +
                "(function(){ " +
                "var k=document.createElement('script');k.type='text/javascript';k.async=true; " +
                "var m,src=(m=location.href.match(/\bkxsrc=([^&]+)/))&&decodeURIComponent(m[1]); " +
                "k.src = /^https?:\\/\\/([a-z0-9_\\-\\.]+\\.)?krxd\\.net(:\\d{1,5})?\\//i.test(src) ? src : src === 'disable' ? '' : " +
                "(location.protocol==='https:'?'https:':'http:')+'//cdn.krxd.net/controltag?confid=J_RxuxWJ' ; " +
                "var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s); }());";

            document.body.appendChild(krux);
        }

        function buildSegments() {
            var filling, kruxSegments, output, ref;
            var targeting = "";
            kruxSegments = (ref = localStorage.getItem('kxsegs')) != null ? ref : "";
            if (kruxSegments !== "") {
                filling = kruxSegments.split(',').join("','");
                output = "['" + filling + "']";
                targeting += ".setTargeting('x', " + output + ")";
            }
            return targeting;
        }

        function insertScript(content) {
            var script = document.createElement("script");
            script.type = "text/javascript";
            document.body.appendChild(script);
            return script.text = content;
        }

        function buildTargetSize(sizes) {
            return "[" +
                sizes
                .split(',')
                .map(function (size) {
                    return size === "fluid" ? "'fluid'" : "[" + size.replace('x', ',') + "]"
                })
                .join(',') +
            "]";
        }

        function buildCustomTargeting() {
            var attr, i, key, len, match, value;
            var targeting = "";
            var ref = Object.keys(settings);
            for (i = 0, len = ref.length; i < len; i++) {
                attr = ref[i];
                match = attr.match(/^data-ad-target-(.+)$/);
                if (match != null) {
                    key = match[1];
                    value = settings[attr].replace(/\s*,\s*/g, "','");
                    targeting += ".setTargeting('" + key + "',['" + value + "'])";
                }
            }
            return targeting;
        }

        function buildAdtestTargeting() {
            var adtest = settings.at;
            return adtest ? ".setTargeting('at', '" + adtest + "')" : "";
        }

        function insertAdConfig() {
            var isFirstAd = true;
            if (isFirstAd) {
                var pageLevelCodePart1 = "var googletag = googletag || {}; googletag.cmd = googletag.cmd || []; (function() { var gads = document.createElement(\"script\"); gads.async = true; gads.type = \"text/javascript\"; var useSSL = \"https:\" == document.location.protocol; gads.src = (useSSL ? \"https:\" : \"http:\") + \"//www.googletagservices.com/tag/js/gpt.js\"; var node = document.getElementsByTagName(\"script\")[0]; node.parentNode.insertBefore(gads, node); })();";
                insertScript(pageLevelCodePart1);
                var pageLevelCodePart2 = "googletag.cmd.push(function() { googletag.pubads().enableAsyncRendering(); googletag.pubads().collapseEmptyDivs(); googletag.enableServices(); });";
                insertScript(pageLevelCodePart2);
            }
            var size = settings['data-ad-size'];
            var adUnitName = settings['data-ad-unit'];
            var slotDeclaration = "googletag.cmd.push(function() {" +
                "googletag.defineSlot('/59666047/" + adUnitName + "', " + (buildTargetSize(size)) + ", 'ad-slot-1')" +
                (buildCustomTargeting()) +
                (buildAdtestTargeting()) +
                (buildSegments()) +
                ".addService(googletag.pubads());" +
                " });";
            return insertScript(slotDeclaration);
        }

        function insertAd() {
            var slotDiv = document.createElement("div");
            slotDiv.setAttribute('id', 'ad-slot-1');
            document.body.appendChild(slotDiv);
            var slotCode = "googletag.cmd.push(function() { googletag.display('ad-slot-1'); });";
            return insertScript(slotCode);
        }

        function init() {
            exposeMetaDataForKrux();
            loadKrux();

            insertAdConfig();
            insertAd();
        }

        init();

    </script>

</div>
<script>if (window.docEndCallback) window.docEndCallback()</script>
</body>
</html>
