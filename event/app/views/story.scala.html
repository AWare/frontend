@(page: StoryPage)(implicit request: RequestHeader)

@section(title: String, content: Seq[model.Content]) = {
    <li><a href="#">@title <i class="i i-filter-arrow-right"></i></a>
        <section class="story-@title.toLowerCase">
            @fragments.trailblocks.thumbnail(content.sortBy(_.importance).take(2), numItemsVisible = 2, numThumbnails = 2, headingLevel = 3)
        </section>
    </li>
}

@main(page, Switches.all){ }{

@defining(page.story){ story =>

    <h1 class="article-zone type-1">
        <span class="zone-color">@story.title</span>
    </h1>

    <section class="story-overview">
        @story.hero.map{ img =>
            <figure itemprop="associatedMedia primaryImageOfPage" itemscope itemtype="http://schema.org/ImageObject">
                <img class="maxed main-image" src="@story.hero"
                     itemprop="contentURL"
                     alt="@StripHtmlTags(story.title)"
                     title="@StripHtmlTags(story.title)" />
            </figure>
        }
        <h2 class="page-head">Overview</h2>
        <p class="story-explainer box-indent type-7" itemprop="description" data-link-name="explainer">
            @cleanTrailText(story.explainer.getOrElse(""))
        </p>
    </section>

    <ul class="accordion">

        @story.contentByColour.get("Background").map{ content => @section("Background", content) }
        @story.contentByColour.get("Analysis").map{ content => @section("Analysis", content) }
        @story.contentByColour.get("Reaction").map{ content => @section("Reaction", content) }

        <li><a href="#">Key players <i class="i i-filter-arrow-right"></i></a>
            <section class="story-players">
                @{
                    story.events.map { event => event.agents }.flatten.map { agent =>
                        <h3 class="box-indent"><a href="#">{agent.name.getOrElse("")}</a></h3>
                        <p class="box-indent type-7">{agent.role.getOrElse("")}</p>
                        <p class="box-indent type-7">{agent.explainer.getOrElse("")}</p>
                    }
                }
            </section>
        </li>
        <li><a href="#">Timeline of events <i class="i i-filter-arrow-right"></i></a>
            <section class="story-timeline">
                <div id="experiment" class="trailblock timeline" data-count="@{story.events.size - 4}" data-link-name="Event timeline">
                    <ul class="unstyled">
                        @story.events.map { event =>
                            @event.content.take(1).zipWithRowInfo.map{ case (trail, info) =>
                            <li class="trail event-block" data-link-name="trail">
                                @fragments.relativeDate(event.startDate, trail.isLive, isFront=true)
                                <div class="date-line">
                                    <h3 class="type-5">@event.title</h3>
                                    <!-- Articles -->
                                    @event.content.map{ case (c) =>

                                    <!-- People -->
                                    @event.agents.filter(_.rdfType == "http://schema.org/Person").map { agent =>
                                    <img src="@agent.picture" alt="@agent.name, @agent.role"/>
                                    }
                                    }
                                </div>
                            </li>
                            }
                        }
                    </ul>
                </div>
            </section>
        </li>
    </ul>
 }
}
